# Helm Chart Values Documentation

This README outlines the configuration options available in the Helm chart for Open Policy Agent (OPA) Gatekeeper policies, optimized for environments with several key policies enabled by default.

## Before deploy these policies

First install the OPA gatekeeper operator:
https://github.com/open-policy-agent/gatekeeper/blob/master/charts/gatekeeper/README.md

# Dependencies

## Falco

This is an agent that provides visibility over the threats in the OS level based on rules.
The helm chart can be found here:  `https://github.com/falcosecurity/charts/tree/master/charts/falco`.

It also installs Falco Sick Kick to visualise triggered rules.



# Helm Chart Values Table

| **Parameter**                                   | **Description**                                                                                           | **Default Value**                                  | **Reference URL**                                                                                                          |
|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------|---------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| `global.cloudOrigin`                            | Specifies the cloud provider environment.                                                                 | `"azure"`                                         | N/A                                                                                                                      |
| `privilegedContainer.enabled`                   | Restrict the use of privileged containers.                                                                | `true`                                            | [Privileged Containers](https://open-policy-agent.github.io/gatekeeper-library/website/validation/privileged-containers/) |
| `privilegedContainer.excludedNamespaces`        | Namespaces exempt from the privileged container policy.                                                   | `["kube-system", "default"]`                     | [Privileged Containers](https://open-policy-agent.github.io/gatekeeper-library/website/validation/privileged-containers/) |
| `privilegedContainer.exemptImages`              | Container images exempt from the privileged container policy.                                             | `[]`                                             | [Privileged Containers](https://open-policy-agent.github.io/gatekeeper-library/website/validation/privileged-containers/) |
| `hostNamespace.enabled`                         | Restrict usage of host namespaces.                                                                        | `true`                                            | [Host Namespaces](https://open-policy-agent.github.io/gatekeeper-library/website/validation/host-namespaces/)             |
| `hostNamespace.excludedNamespaces`              | Namespaces exempt from the host namespace policy.                                                         | `[]`                                             | [Host Namespaces](https://open-policy-agent.github.io/gatekeeper-library/website/validation/host-namespaces/)             |
| `privilegeEscalationContainer.enabled`          | Restrict privilege escalation in containers.                                                              | `true`                                            | [Privilege Escalation](https://open-policy-agent.github.io/gatekeeper-library/website/validation/allow-privilege-escalation) |
| `privilegeEscalationContainer.exemptImages`     | Container images exempt from the privilege escalation policy.                                             | `[]`                                             | [Privilege Escalation](https://open-policy-agent.github.io/gatekeeper-library/website/validation/allow-privilege-escalation) |
| `readOnlyRootFilesystem.enabled`               | Enforce containers to use read-only root filesystems.                                                     | `true`                                            | [Read-Only Root Filesystem](https://open-policy-agent.github.io/gatekeeper-library/website/validation/read-only-root-filesystem) |
| `readOnlyRootFilesystem.exemptImages`          | Container images exempt from the read-only root filesystem policy.                                        | `[]`                                             | [Read-Only Root Filesystem](https://open-policy-agent.github.io/gatekeeper-library/website/validation/read-only-root-filesystem) |
| `allowedRepositories.enabled`                   | Restrict container images to specific repositories.                                                       | `true`                                            | [Allowed Repositories](https://open-policy-agent.github.io/gatekeeper-library/website/validation/allowedrepos)            |
| `allowedRepositories.repos`                     | List of allowed repositories for container images.                                                        | `["registry.k8s.io/", "nginx"]`                  | [Allowed Repositories](https://open-policy-agent.github.io/gatekeeper-library/website/validation/allowedrepos)            |
| `automountServiceAccountTokenForPod.enabled`    | Restrict automounting service account tokens in pods.                                                     | `true`                                            | [Automount Service Account Token](https://open-policy-agent.github.io/gatekeeper-library/website/validation/automount-serviceaccount-token) |
| `automountServiceAccountTokenForPod.excludedNamespaces` | Namespaces exempt from the automount service account token policy.                                        | `["kube-system"]`                                | [Automount Service Account Token](https://open-policy-agent.github.io/gatekeeper-library/website/validation/automount-serviceaccount-token) |
| `BlockNodePort.enabled`                         | Block usage of NodePort services.                                                                         | `true`                                            | [Block NodePort](https://open-policy-agent.github.io/gatekeeper-library/website/validation/block-nodeport-services)        |
| `RequiredResources.enabled`                     | Enforce resource requests and limits for containers.                                                      | `true`                                            | [Required Resources](https://open-policy-agent.github.io/gatekeeper-library/website/validation/containerresources)         |
| `RequiredResources.limits`                      | List of resource limits to enforce.                                                                       | `["cpu", "memory"]`                              | [Required Resources](https://open-policy-agent.github.io/gatekeeper-library/website/validation/containerresources)         |
| `RequiredResources.requests`                    | List of resource requests to enforce.                                                                     | `["cpu", "memory"]`                              | [Required Resources](https://open-policy-agent.github.io/gatekeeper-library/website/validation/containerresources)         |
| `DisallowTags.enabled`                          | Restrict the use of specific image tags.                                                                  | `true`                                            | [Disallow Tags](https://open-policy-agent.github.io/gatekeeper-library/website/validation/disallowedtags)                 |
| `DisallowTags.tags`                             | List of disallowed tags.                                                                                   | `["latest"]`                                     | [Disallow Tags](https://open-policy-agent.github.io/gatekeeper-library/website/validation/disallowedtags)                 |
| `ReplicaLimits.enabled`                         | Enforce replica count ranges for workloads.                                                               | `true`                                            | [Replica Limits](https://open-policy-agent.github.io/gatekeeper-library/website/validation/replicalimits)                 |
| `ReplicaLimits.ranges`                          | Define ranges for replica counts.                                                                         | `[{"min_replicas": 2, "max_replicas": 50}]`      | [Replica Limits](https://open-policy-agent.github.io/gatekeeper-library/website/validation/replicalimits)                 |
| `SvcLoadbalancerAnnotations.enabled`            | Enforce annotations on Service type LoadBalancer.                                                         | `true`                                            | N/A                                                                                                                      |
| `DisallowRoot.enabled`                          | Disallow containers running as root                                                                       | `true`                                            | N/A                                                                                                                      |
| `falco.containerSecurityContext`              | Specifies the security context for Falco containers.                                                             | `{}`                              | N/A                                                               |
| `falco.resources.requests.cpu`                | CPU resource request for Falco.                                                                                  | `100m`                            | N/A                                                               |
| `falco.resources.requests.memory`             | Memory resource request for Falco.                                                                               | `512Mi`                           | N/A                                                               |
| `falco.resources.limits.cpu`                  | CPU resource limit for Falco.                                                                                    | `1000m`                           | N/A                                                               |
| `falco.resources.limits.memory`               | Memory resource limit for Falco.                                                                                 | `1024Mi`                          | N/A                                                               |
| `falco.collectors.enabled`                    | Enables data collectors for enriching security events.                                                           | `true`                            | N/A                                                               |
| `falco.collectors.docker.enabled`             | Enable Docker collector for Falco.                                                                               | `false`                           | N/A                                                               |
| `falco.collectors.crio.enabled`               | Enable CRI-O collector for Falco.                                                                                | `false`                           | N/A                                                               |
| `falco.collectors.containerd.enabled`         | Enable Containerd collector for Falco.                                                                           | `true`                            | N/A                                                               |
| `falco.collectors.containerd.socket`          | Path to the Containerd socket file.                                                                              | `/var/run/containerd/containerd.sock` | N/A                                                               |
| `falco.customRules.override-rules.yaml`       | Custom rules for Falco detection.                                                                                | Provided YAML content             | N/A                                                               |
| `falco.falcosidekick.enabled`                 | Enable Falcosidekick for visualizing Falco alerts.                                                               | `true`                            | [Falcosidekick](https://github.com/falcosecurity/falcosidekick)   |
| `falco.falcosidekick.webui.enabled`           | Enable the Falcosidekick Web UI.                                                                                 | `true`                            | [Falcosidekick Web UI](https://github.com/falcosecurity/falcosidekick-ui) |
| `falco.serviceMonitor.create`                 | Create a Prometheus ServiceMonitor for Falco metrics.                                                            | `false`                           | N/A                                                               |
| `falco.serviceMonitor.path`                   | Path to scrape Falco metrics.                                                                                    | `/metrics`                        | N/A                                                               |
| `falco.serviceMonitor.interval`               | Interval between Prometheus scrapes.                                                                             | `15s`                             | N/A                                                               |
| `falco.serviceMonitor.scrapeTimeout`          | Timeout for Prometheus scrapes.                                                                                  | `10s`                             | N/A                                                               |
| `falco.serviceMonitor.endpointPort`           | Port for Prometheus to scrape Falco metrics.                                                                     | `"metrics"`                       | N/A                                                               |
| `falco.rules_files`                           | List of rule files to load in Falco.                                                                             | `/etc/falco/falco_rules.yaml`, `/etc/falco/falco_rules.local.yaml`, `/etc/falco/rules.d` | N/A |